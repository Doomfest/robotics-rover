#!/usr/bin/env python2.7

import sys
import roboticsnet
from roboticsnet.rover_listener import RoverListener
from roboticsnet.command_hook import CommandHook

import roboticsrov
from roboticsrov.rover_constants import *
from roboticsrov.stream.video_stream import VideoStream 
from roboticsrov.umanager import UManager 

hookString = ""

try:
    webcam_stream = VideoStream('/dev/video0',8081)
    hookString += generate_webcam_hook_string("webcam_stream")
except Exception as e:
    print e.message

try:
    uManager = UManager()
    hookString += generate_motor_hook_string("uManager")
except Exception as e:
    print e.message

print "Starting server with hooks:\n" + hookString

cmdHook = CommandHook(hookString)
server = RoverListener(hooks=cmdHook)

print roboticsrov.__appname__, " ", roboticsrov.__version__
print "Starting command dispatcher..."
server.listen()
