#!/usr/bin/env python2.7

import sys
import roboticsnet
from roboticsnet.rover_listener import RoverListener
from roboticsnet.command_hook import CommandHook

import roboticsrov
from roboticsrov.stream.video_stream import VideoStream 
from roboticsrov.umanager import UManager 


ard = True

try:
    webcam_stream = VideoStream('/dev/video0',8081)
except Exception as e:
    print e.message

try:
    uManager = UManager()
    cmdHook = CommandHook(
        forward=uManager.forward,
        reverse=uManager.reverse,  
        forwardLeft=uManager.forwardLeft,
        forwardRight=uManager.forwardRight,
        reverseLeft=uManager.reverseLeft,
        reverseRight=uManager.reverseRight,
        stop=uManager.stop,
        startVideo=webcam_stream.start,
        stopVideo=webcam_stream.end)
except Exception as e:
    print e.message
    cmdHook = CommandHook(
        startVideo=webcam_stream.start,
        stopVideo=webcam_stream.end)
    


server = RoverListener(hooks=cmdHook)

print roboticsrov.__appname__, " ", roboticsrov.__version__
print "Starting command dispatcher..."
server.listen()
